
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Swimmers</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
</head>
<body>
    <h1>Swimmers GALA records</h1>
    
    <button id="showCreateButton" onclick="showCreate()">Add Swimmer</button>

    <table border="2" class="table" id="swimmerTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Sex</th>
                <th>Age Group</th>
                <th>Event</th>
                <th>Date</th>
                <th>Time</th>
                <th>Update</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody id="swimmerBody"></tbody>  
    </table>
    
    <div id="createUpdateForm" style="display:none">
        <h3>
            <span id="createLabel">Create</span>
            <span id="updateLabel" style="display:none">Update</span> Swimmer
        </h3>
        <input type="hidden" name="id"/>
        First Name: <input type="text" name="first_name"><br/>
        Last Name: <input type="text" name="last_name"><br/>
        Sex: <input type="text" name="sex"><br/>
        Age Group: <input type="number" name="age_group"><br/>
        Event: <input type="text" name="event"><br/>
        Date: <input type="date" name="date"><br/>
        Time: <input type="text" name="time" placeholder="MM:SS:ss"><br/>  
        
        <button id="doCreateButton" onclick="doCreate()">Create</button>
        <button id="doUpdateButton" onclick="doUpdate()" style="display:none">Update</button>

    </div>

    <script>
        // check time format
        function isValidTimeFormat(timeStr) {
            return /^\d{2}:\d{2}:\d{2}$/.test(timeStr); 
        }

        // add swimmer
        function doCreate() {
            const form = document.getElementById("createUpdateForm");
            const timeVal = form.querySelector('input[name="time"]').value;

            if (!isValidTimeFormat(timeVal)) {
            alert("Please enter time in MM:SS:ss format (e.g., 02:45:37)");
                return;
            }    

            alert("Time format is correct")
        }

        // create swimmer
        
        // get all

        function getAllswimmers() {
            $.ajax({
                url: "/results",
                method: "GET",
                dataType: "json",
                success: function (data) { // data - list of swimmers in json
                    for (let swimmer of data) {
                        addSwimmerToTable(swimmer);// each swimmer will be added with this function
                    }
                },
                error: function (xhr, status, error) {
                    alert("Failed to load swimmers: " + error);
                }
            });
        }
        // add swimmer
        function addSwimmerToTable(swimmer) {
    const table = document.getElementById("swimmerBody");

    const row = document.createElement("tr");
            // create a table raw
    row.innerHTML = `
        <td>${swimmer.id}</td>
        <td>${swimmer.first_name}</td>
        <td>${swimmer.last_name}</td>
        <td>${swimmer.sex}</td>
        <td>${swimmer.age_group}</td>
        <td>${swimmer.event}</td>
        <td>${swimmer.date}</td>
        <td>${swimmer.time}</td>
        <td><button onclick="showUpdate(${swimmer.id})">Update</button></td>
        <td><button onclick="doDelete(${swimmer.id})">Delete</button></td>
    `;

    table.appendChild(row);
}
    // update
function showUpdate(id) {
    alert("Update swimmer ID: " + id);
}
    // delete
function doDelete(id) {
    alert("Delete swimmer ID: " + id);
}



    getAllswimmers();










    </script>


</body>
</html>